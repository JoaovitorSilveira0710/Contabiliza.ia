<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Contabiliza.IA</title>
    <link rel="icon" type="image/svg+xml" href="/icon.svg">
  <link rel="icon" href="/src/styles/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="/dist/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/src/js/config.js?v=20251202"></script>
  <script src="/src/js/ui-helper.js?v=20251202"></script>
  <script src="/src/js/api-service.js?v=20251202"></script>
  <link rel="stylesheet" href="/src/styles/globals.css?v=20251202">
</head>
<body class="bg-gray-900 text-white">
  <!-- Toast -->
  <div id="toast" class="toast bg-gray-800 shadow-lg hidden"></div>

  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-800 border-r border-gray-700 flex flex-col">
      <!-- Logo -->
      <div class="p-6 border-b border-gray-700">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg flex items-center justify-center animate-pulse">
            <i class="fas fa-calculator text-white"></i>
          </div>
          <span class="text-lg font-bold bg-gradient-to-r from-purple-400 to-indigo-400 bg-clip-text text-transparent">Contabiliza.IA</span>
        </div>
      </div>

      <!-- Navega√ß√£o -->
      <nav class="p-4 space-y-2" id="sidebarNav">
        <a href="/pages/dashboard.html" class="flex items-center gap-3 px-4 py-3 bg-purple-600/20 text-purple-400 rounded-lg border border-purple-600/30">
          <i class="fas fa-chart-line w-5"></i> Dashboard
        </a>
        <a href="/pages/clientes.html" class="flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-lg transition-all">
          <i class="fas fa-users w-5"></i> Clientes
        </a>
        <a href="/pages/notas-fiscais.html" class="flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-lg transition-all">
          <i class="fas fa-file-invoice w-5"></i> Notas Fiscais
        </a>
        <a href="/pages/financeiro.html" class="flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-lg transition-all">
          <i class="fas fa-chart-bar w-5"></i> Financeiro
        </a>
        <a href="/pages/juridico.html" class="flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-lg transition-all">
          <i class="fas fa-scale-balanced w-5"></i> Jur√≠dico
        </a>
        <a href="/pages/relatorios.html" class="flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-lg transition-all">
          <i class="fas fa-file-pdf w-5"></i> Relat√≥rios
        </a>
        <a href="/pages/estoque.html" class="flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-lg transition-all">
          <i class="fas fa-boxes-stacked w-5"></i> Estoque
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-auto">
      <!-- Header -->
      <header class="bg-gray-800 border-b border-gray-700 sticky top-0 z-40">
        <div class="flex justify-between items-center px-6 py-4">
          <div class="flex items-center gap-4">
            <h2 class="text-2xl font-bold text-white">Dashboard</h2>
            <p class="text-gray-400 text-sm">Vis√£o geral do sistema</p>
          </div>
          <div class="flex items-center gap-4">
            <!-- Data e Hora -->
            <div class="flex items-center gap-2 text-sm text-gray-300">
              <i class="fas fa-clock text-purple-400"></i>
              <span id="currentDateTime"></span>
            </div>
            <!-- Atualizar -->
            <button onclick="loadDashboard()" class="p-2 text-gray-300 hover:text-white hover:bg-gray-700 rounded-lg transition-all" title="Atualizar Dashboard">
              <i class="fas fa-sync-alt text-xl"></i>
            </button>
            <!-- Notifica√ß√µes -->
            <button class="relative p-2 text-gray-300 hover:text-white hover:bg-gray-700 rounded-lg transition-all" title="Notifica√ß√µes">
              <i class="fas fa-bell text-xl"></i>
              <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
            </button>
            <!-- Configura√ß√µes (Master/Admin) -->
            <a href="/pages/configuracoes.html" id="configButton" class="hidden p-2 text-gray-300 hover:text-white hover:bg-gray-700 rounded-lg transition-all" title="Configura√ß√µes">
              <i class="fas fa-cog text-xl"></i>
            </a>
            <!-- Usu√°rio -->
            <div class="flex items-center gap-3 pl-4 border-l border-gray-700">
              <div class="text-right">
                <p class="text-sm font-medium text-white" id="userName"></p>
                <p class="text-xs text-gray-400" id="userEmail"></p>
              </div>
              <button onclick="logout()" class="px-4 py-2 bg-red-600 rounded-lg hover:bg-red-700 text-sm transition-all">
                <i class="fas fa-sign-out-alt mr-1"></i> Sair
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Content -->
      <div class="p-6 space-y-6">
        <!-- Metrics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
          <!-- Total Clientes -->
          <div class="glass-card p-6">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-gray-400 text-sm">Total de Clientes</p>
                <p class="text-3xl font-bold text-white mt-2" id="totalClientes">0</p>
              </div>
              <div class="bg-blue-600/20 p-3 rounded-lg">
                <i class="fas fa-users text-blue-400 text-2xl"></i>
              </div>
            </div>
          </div>

          <!-- Total Receita -->
          <div class="glass-card p-6">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-gray-400 text-sm">Receita Mensal</p>
                <p class="text-3xl font-bold text-white mt-2" id="totalReceita">R$ 0</p>
              </div>
              <div class="bg-green-600/20 p-3 rounded-lg">
                <i class="fas fa-wallet text-green-400 text-2xl"></i>
              </div>
            </div>
          </div>

          <!-- Notas Fiscais -->
          <div class="glass-card p-6">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-gray-400 text-sm">Notas Fiscais</p>
                <p class="text-3xl font-bold text-white mt-2" id="totalNotas">0</p>
              </div>
              <div class="bg-amber-600/20 p-3 rounded-lg">
                <i class="fas fa-file-invoice text-amber-400 text-2xl"></i>
              </div>
            </div>
          </div>

          <!-- Pend√™ncias -->
          <div class="glass-card p-6">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-gray-400 text-sm">Processos Ativos</p>
                <p class="text-3xl font-bold text-white mt-2" id="totalPendencias">0</p>
              </div>
              <div class="bg-orange-600/20 p-3 rounded-lg">
                <i class="fas fa-scale-balanced text-orange-400 text-2xl"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Revenue Chart -->
          <div id="revenueChartRoot"></div>

          <!-- Pie Chart -->
          <div id="categoryChartRoot"></div>
        </div>

        <!-- Recent Clients -->
        <div class="glass-card">
          <div class="px-6 py-4 border-b border-gray-700">
            <h3 class="text-lg font-bold text-white">Clientes Recentes</h3>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-800/50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Cliente</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">CPF/CNPJ</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="clientesTable" class="bg-gray-800/20">
                <tr>
                  <td colspan="4" class="px-6 py-8 text-center text-gray-400">Carregando...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const { useState, useEffect, useMemo } = React;
    let autoRefreshInterval = null;
    let revenueChartRoot = null;
    let categoryChartRoot = null;

    // Verificar autentica√ß√£o e inserir link Configura√ß√µes (Master/Admin)
    (function authAndConfigLink(){
      if (!UTILS.isAuthenticated()) {
        window.location.href = '/pages/login.html';
        return;
      }
      const user = UTILS.getCurrentUser(); // espera { email, role }
      const userRole = user?.role || localStorage.getItem('USER_ROLE');
      const userEmail = user?.email || localStorage.getItem('USER_EMAIL');
      const userName = localStorage.getItem('USER_NAME') || userEmail?.split('@')[0] || 'Usu√°rio';
      
      // Preencher dados do usu√°rio
      if (document.getElementById('userName')) {
        document.getElementById('userName').textContent = userName;
      }
      if (document.getElementById('userEmail')) {
        document.getElementById('userEmail').textContent = userEmail || '';
      }
      
      // Mostrar bot√£o de configura√ß√µes no header
      if (userRole === 'master' || userRole === 'admin') {
        const configBtn = document.getElementById('configButton');
        if (configBtn) configBtn.classList.remove('hidden');
      }
      
      // Adicionar link na sidebar
      const nav = document.getElementById('sidebarNav');
      if (user && nav && (userRole === 'master' || userRole === 'admin')) {
        const link = document.createElement('a');
        link.href = '/pages/configuracoes.html';
        link.className = 'flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-lg transition-all';
        link.innerHTML = '<i class="fas fa-cog w-5"></i> Configura√ß√µes';
        nav.appendChild(link);
      }
    })();

    // Atualizar data e hora em tempo real
    function updateDateTime() {
      const now = new Date();
      const options = { 
        weekday: 'short', 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      document.getElementById('currentDateTime').textContent = now.toLocaleDateString('pt-BR', options);
    }
    updateDateTime();
    setInterval(updateDateTime, 60000); // Atualizar a cada minuto

    // Iniciar auto-refresh a cada 30 segundos
    function startAutoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
      }
      autoRefreshInterval = setInterval(() => {
        loadDashboard();
      }, 30000); // 30 segundos
    }

    // Parar auto-refresh ao sair da p√°gina
    window.addEventListener('beforeunload', () => {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
      }
    });

    // Carregar dados do dashboard
    async function loadDashboard() {
      try {
        // Buscar dados reais das APIs
        const [clientesResp, transacoesResp, notasResp, processosResp] = await Promise.all([
          apiService.getClientes().catch(() => ({ results: [] })),
          apiService.getTransacoesFinanceiras().catch(() => ({ results: [] })),
          apiService.getNotasFiscais().catch(() => ({ results: [] })),
          apiService.getProcessos().catch(() => ({ results: [] }))
        ]);

        // Normalizar respostas paginadas (DRF) para arrays simples
        const clientesData = Array.isArray(clientesResp) ? clientesResp : (clientesResp?.results || []);
        const transacoesData = Array.isArray(transacoesResp) ? transacoesResp : (transacoesResp?.results || []);
        const notasData = Array.isArray(notasResp) ? notasResp : (notasResp?.results || []);
        const processosData = Array.isArray(processosResp) ? processosResp : (processosResp?.results || []);

        // Processar clientes
        const totalClientes = Array.isArray(clientesData) ? clientesData.length : 0;
        document.getElementById('totalClientes').textContent = totalClientes;

        // Processar transa√ß√µes financeiras
        const transacoes = Array.isArray(transacoesData) ? transacoesData : [];
        const receitasMes = transacoes
          .filter(t => t.transaction_type === 'revenue' && (t.status === 'received' || t.status === 'paid'))
          .reduce((sum, t) => sum + (parseFloat(t.final_amount || t.amount) || 0), 0);
        document.getElementById('totalReceita').textContent = UTILS.formatarReal(receitasMes);

        // Processar notas fiscais
        const totalNotas = Array.isArray(notasData) ? notasData.length : 0;
        document.getElementById('totalNotas').textContent = totalNotas;

        // Processar processos jur√≠dicos ativos
        const processosAtivos = Array.isArray(processosData) 
          ? processosData.filter(p => p.status && p.status !== 'closed' && p.status !== 'finished').length 
          : 0;
        document.getElementById('totalPendencias').textContent = processosAtivos;

        // Carregar clientes recentes
        loadClientes();

        // Inicializar gr√°ficos com dados reais usando React
        renderCharts({ transacoes, notas: notasData });

      } catch (error) {
        console.error('Erro ao carregar dashboard:', error);
        UTILS.showToast('Erro ao carregar dados do dashboard', 'error');
      }
    }

    async function loadClientes() {
      try {
        console.log('üîÑ Loading clients...');
        const clientes = await apiService.getClientes();
        console.log('‚úÖ Clients response:', clientes);
        
        const clientesArray = Array.isArray(clientes) ? clientes : (clientes?.results || []);
        const clientesRecentes = clientesArray.slice(0, 5);
        
        console.log('üìä Recent clients (5):', clientesRecentes);
        
        const tbody = document.getElementById('clientesTable');
        
        if (!tbody) {
          console.error('‚ùå Table body not found!');
          return;
        }
        
        tbody.innerHTML = '';

        if (clientesRecentes.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-gray-400">Nenhum cliente encontrado</td></tr>';
          return;
        }

        clientesRecentes.forEach((cliente, index) => {
          console.log(`Building row ${index + 1}:`, cliente);
          const isActive = cliente.status === 'active' || cliente.status === 'ativo';
          const clientName = cliente.trade_name || cliente.name || 'N/A';
          const clientEmail = cliente.email || 'Sem email';
          const clientTaxId = cliente.tax_id || '';
          
          const row = document.createElement('tr');
          row.className = 'border-b border-gray-700/50 hover:bg-gray-700/30 transition-colors';
          row.innerHTML = `
            <td class="px-6 py-4">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center flex-shrink-0">
                  <i class="fas fa-building text-white text-sm"></i>
                </div>
                <div class="min-w-0">
                  <div class="text-sm font-medium text-white truncate">${clientName}</div>
                  <div class="text-sm text-gray-400 truncate">${clientEmail}</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-300">${UTILS.formatarCNPJ(clientTaxId)}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${isActive ? 'bg-green-600/20 text-green-400' : 'bg-red-600/20 text-red-400'}">
                ${isActive ? 'Ativo' : 'Inativo'}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <button onclick="window.location.href='/pages/clientes.html?id=${cliente.id}'" class="text-purple-400 hover:text-purple-300 font-medium transition-colors">
                <i class="fas fa-eye mr-1"></i>Ver detalhes
              </button>
            </td>
          `;
          tbody.appendChild(row);
        });
        
        console.log('‚úÖ Clients table updated successfully!');

      } catch (error) {
        console.error('‚ùå Error loading clients:', error);
        const tbody = document.getElementById('clientesTable');
        if (tbody) {
          tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-red-400"><i class="fas fa-exclamation-triangle mr-2"></i>Erro ao carregar clientes</td></tr>';
        }
      }
    }

    // React Components for Charts
    function RevenueChart({ transacoes }) {
      const canvasRef = React.useRef(null);
      const chartRef = React.useRef(null);

      useEffect(() => {
        if (!canvasRef.current || !transacoes) return;

        // Destroy old chart
        if (chartRef.current) {
          chartRef.current.destroy();
        }

        // Process transaction data
        const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
        const hoje = new Date();
        const labels = [];
        const receitasPorMes = [];
        const despesasPorMes = [];

        for (let i = 5; i >= 0; i--) {
          const data = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
          labels.push(meses[data.getMonth()]);
          
          const receitas = transacoes
            .filter(t => {
              const tData = new Date(t.due_date || t.payment_date);
              return t.transaction_type === 'revenue' && 
                     tData.getMonth() === data.getMonth() && 
                     tData.getFullYear() === data.getFullYear();
            })
            .reduce((sum, t) => sum + parseFloat(t.final_amount || t.amount || 0), 0);
          
          const despesas = transacoes
            .filter(t => {
              const tData = new Date(t.due_date || t.payment_date);
              return t.transaction_type === 'expense' && 
                     tData.getMonth() === data.getMonth() && 
                     tData.getFullYear() === data.getFullYear();
            })
            .reduce((sum, t) => sum + parseFloat(t.final_amount || t.amount || 0), 0);
          
          receitasPorMes.push(receitas);
          despesasPorMes.push(despesas);
        }

        // Create chart
        chartRef.current = new Chart(canvasRef.current, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'Receitas',
                data: receitasPorMes,
                borderColor: '#10B981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                fill: true,
                tension: 0.4,
                borderWidth: 2
              },
              {
                label: 'Despesas',
                data: despesasPorMes,
                borderColor: '#EF4444',
                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                fill: true,
                tension: 0.4,
                borderWidth: 2
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: '#E5E7EB',
                  font: { size: 12 }
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.dataset.label + ': ' + UTILS.formatarReal(context.parsed.y);
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: 'rgba(107, 114, 128, 0.2)'
                },
                ticks: {
                  color: '#9CA3AF',
                  callback: function(value) {
                    return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                  }
                }
              },
              x: {
                grid: {
                  color: 'rgba(107, 114, 128, 0.2)'
                },
                ticks: {
                  color: '#9CA3AF'
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [transacoes]);

      return React.createElement('div', { className: 'glass-card p-6' },
        React.createElement('h3', { className: 'text-lg font-bold text-white mb-4' }, 'Faturamento Mensal'),
        React.createElement('div', { style: { height: '300px', position: 'relative' } },
          React.createElement('canvas', { ref: canvasRef })
        )
      );
    }

    function CategoryChart({ transacoes }) {
      const canvasRef = React.useRef(null);
      const chartRef = React.useRef(null);

      useEffect(() => {
        if (!canvasRef.current || !transacoes) return;

        // Destroy old chart
        if (chartRef.current) {
          chartRef.current.destroy();
        }

        // Calculate totals by category
        let labelsPie = [];
        let dataPie = [];
        
        if (transacoes.length > 0) {
          const categoriasPorValor = {};
          
          transacoes.forEach((t) => {
            const categoria = t.category_name || 'Sem Categoria';
            const valor = parseFloat(t.final_amount || t.amount || 0);
            
            const isPago = t.status === 'paid' || t.status === 'received' || t.status === 'pago';
            if (isPago && valor > 0) {
              categoriasPorValor[categoria] = (categoriasPorValor[categoria] || 0) + valor;
            }
          });
          
          const sorted = Object.entries(categoriasPorValor)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 8);
          
          labelsPie = sorted.map(s => s[0]);
          dataPie = sorted.map(s => s[1]);
        }
        
        if (dataPie.length === 0) {
          labelsPie = ['Sem dados'];
          dataPie = [1];
        }

        // Create chart
        chartRef.current = new Chart(canvasRef.current, {
          type: 'doughnut',
          data: {
            labels: labelsPie,
            datasets: [{
              data: dataPie,
              backgroundColor: [
                'rgba(139, 92, 246, 0.8)',
                'rgba(16, 185, 129, 0.8)',
                'rgba(245, 158, 11, 0.8)',
                'rgba(239, 68, 68, 0.8)',
                'rgba(59, 130, 246, 0.8)',
                'rgba(236, 72, 153, 0.8)',
                'rgba(14, 165, 233, 0.8)',
                'rgba(168, 85, 247, 0.8)'
              ],
              borderColor: [
                'rgba(139, 92, 246, 1)',
                'rgba(16, 185, 129, 1)',
                'rgba(245, 158, 11, 1)',
                'rgba(239, 68, 68, 1)',
                'rgba(59, 130, 246, 1)',
                'rgba(236, 72, 153, 1)',
                'rgba(14, 165, 233, 1)',
                'rgba(168, 85, 247, 1)'
              ],
              borderWidth: 3
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'bottom',
                labels: {
                  color: '#9ca3af',
                  font: { size: 12 },
                  padding: 15,
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                backgroundColor: 'rgba(31, 41, 55, 0.95)',
                titleColor: '#fff',
                bodyColor: '#e5e7eb',
                borderColor: 'rgba(139, 92, 246, 0.5)',
                borderWidth: 1,
                padding: 12,
                callbacks: {
                  label: function(context) {
                    if (context.label === 'Sem dados') return 'Nenhuma transa√ß√£o paga';
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percent = ((context.parsed / total) * 100).toFixed(1);
                    const value = UTILS.formatarReal(context.parsed);
                    return context.label + ': ' + value + ' (' + percent + '%)';
                  }
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [transacoes]);

      return React.createElement('div', { className: 'glass-card p-6' },
        React.createElement('h3', { className: 'text-lg font-bold text-white mb-4' }, 'Distribui√ß√£o por Categoria'),
        React.createElement('div', { style: { height: '300px', position: 'relative' } },
          React.createElement('canvas', { ref: canvasRef })
        )
      );
    }

    function renderCharts(data) {
      const transacoes = data.transacoes || [];

      // Render Revenue Chart
      if (!revenueChartRoot) {
        revenueChartRoot = ReactDOM.createRoot(document.getElementById('revenueChartRoot'));
      }
      revenueChartRoot.render(React.createElement(RevenueChart, { transacoes }));

      // Render Category Chart
      if (!categoryChartRoot) {
        categoryChartRoot = ReactDOM.createRoot(document.getElementById('categoryChartRoot'));
      }
      categoryChartRoot.render(React.createElement(CategoryChart, { transacoes }));
    }

    function logout() {
      localStorage.clear();
      sessionStorage.clear();
      window.location.href = '/pages/login.html?logout=true';
    }

    // Carregar dados ao abrir
    loadDashboard();
    
    // Iniciar auto-refresh
    startAutoRefresh();
  </script>
  
  <!-- Scripts de configura√ß√£o -->
  <!-- Removido include duplicado de config.js para evitar 'Identifier CONFIG already declared' -->
  <!-- <script src="../src/js/config.js"></script> -->
  <!-- Removido api.js legado se n√£o utilizado -->
  <!-- <script src="../src/js/api.js"></script> -->
</body>
</html>
